name: CI

on:
  push:
    branches:
      - master

jobs:
  CI_master:
    strategy:
      matrix:
        container: ["tjysdsg/tanlang:latest"]

    runs-on: ubuntu-18.04
    container:
      image: ${{ matrix.container }}

    steps:
      - name: checkout
        run: git clone https://github.com/tjysdsg/tan --recursive
      - name: compile tanc
        run: cd tan; bash scripts/compile.sh tanc
      - uses: actions/upload-artifact@v1
        with:
          name: bin
          path: tan/bin
      - name: compile all and test all
        run: cd tan; bash scripts/compile.sh
      - name: upload coverage results
        shell: bash
        env:
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
        run: bash <(curl -s https://codecov.io/bash)

