name: CI

on:
  push:
    branches:
      - master

jobs:
  CI_master:
    strategy:
      matrix:
        container: ["tjysdsg/tanlang:latest"]

    runs-on: ubuntu-18.04
    container:
      image: ${{ matrix.container }}

    steps:
      - name: checkout
        run: git clone https://github.com/tjysdsg/tan --recursive
      - name: compile tanc
        run: cd tan; ./scripts/compile.sh tanc
      - name: prepare artifact
        run: zip -r bin.zip bin
      - uses: actions/upload-artifact@v1
        with:
          name: bin
          path: bin.zip
      - name: compile all
        run: ./scripts/compile.sh all
      - name: compile runtime
        run: ./scripts/compile.sh runtime
      - name: test
        run: ./scripts/test.sh
